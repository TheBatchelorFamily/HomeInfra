controller:
  type: StatefulSet

service:
  port: 80 # Change this from 8080 to 80

# CHANGE HERE: Remove 'main' nesting
ingress:
  enabled: true
  annotations:
    kubernetes.io/ingress.class: traefik
    traefik.ingress.kubernetes.io/router.entrypoints: web
  hosts:
    - host: ha.home
      paths:
        - path: /
          pathType: Prefix

persistence:
  enabled: true
  accessMode: ReadWriteOnce
  size: 5Gi
  storageClass: ""

configuration:
  enabled: true
  forceInit: true
  trusted_proxies:
    - 10.42.0.0/16 # Pod Network (Traefik's IP is here)
    - 10.43.0.0/16 # Service Network
    - 192.168.98.0/24 # Your Local Network (Optional, but helpful)
  templateConfig: |-
      # Loads default set of integrations. Do not remove.
      default_config:

      {{- if .Values.ingress.enabled }}
      http:
        use_x_forwarded_for: true
        trusted_proxies:
          {{- range .Values.configuration.trusted_proxies }}
          - {{ . }}
          {{- end }}
      {{- end}}

      frontend:
        themes: !include_dir_merge_named themes

      automation: !include automations.yaml
      script: !include scripts.yaml
      scene: !include scenes.yaml
